"use client";
import React, { useState, useEffect } from "react";
import {
  MapContainer,
  TileLayer,
  Marker,
  Popup,
  Polygon,
  Polyline,
} from "react-leaflet";
import { LatLngExpression } from "leaflet";
import "leaflet/dist/leaflet.css";
import "leaflet-defaulticon-compatibility";
import "leaflet-defaulticon-compatibility/dist/leaflet-defaulticon-compatibility.webpack.css";

import { populatedPlaces2, structuredMunicipalities } from "@/global/country";
import { populatedPlaces } from "@/global/dataa";

interface PopulatedPlace {
  id: string;
  name: string;
  centerPoint: [number, number];
  coordinates: [number, number][]; // Array of coordinates for polygons
}

const skopjeCoordinates: [number, number] = [42.005, 21.422];
const northMacedoniaCoordinates: [number, number] = [41.56614, 21.698];
const kumanovoCoordinatesPolygon = [
  [21.6686499, 42.1468494],
  [21.6704893, 42.1454599],
  [21.6710901, 42.1448235],
  [21.6722488, 42.1439007],
  [21.6733646, 42.1433279],
  [21.6748238, 42.1428825],
  [21.6751242, 42.1426597],
  [21.6751242, 42.1423415],
  [21.6748667, 42.1420233],
  [21.6746092, 42.1410687],
  [21.674695, 42.1395412],
  [21.6746092, 42.1394776],
  [21.6746092, 42.1387775],
  [21.674695, 42.1387138],
  [21.674695, 42.1378864],
  [21.6748667, 42.1375682],
  [21.6748667, 42.1366135],
  [21.674695, 42.1362316],
  [21.674695, 42.134704],
  [21.6743517, 42.1334947],
  [21.6744375, 42.1319034],
  [21.6743517, 42.1318397],
  [21.6743517, 42.1298665],
  [21.6744375, 42.1295482],
  [21.6741371, 42.1293254],
  [21.6723347, 42.1293254],
  [21.6713905, 42.1291345],
  [21.6709185, 42.1287844],
  [21.6704819, 42.1278584],
  [21.6703831, 42.1277843],
  [21.6704705, 42.1277979],
  [21.6706582, 42.127592],
  [21.6706733, 42.1275226],
  [21.6728497, 42.125697],
  [21.6732788, 42.125697],
  [21.6736221, 42.1258243],
  [21.6765234, 42.1262826],
  [21.6772391, 42.126403],
  [21.6772751, 42.1263875],
  [21.6773952, 42.1263875],
  [21.6774102, 42.126432],
  [21.6778935, 42.1264899],
  [21.6831226, 42.1270865],
  [21.6851758, 42.1270865],
  [21.6857641, 42.1271399],
  [21.6858482, 42.1262316],
  [21.6876372, 42.1261515],
  [21.6876613, 42.1260624],
  [21.6883457, 42.1260268],
  [21.6885618, 42.12657],
  [21.6884657, 42.1268194],
  [21.6886218, 42.1270242],
  [21.6887179, 42.1274516],
  [21.6891261, 42.1278167],
  [21.689006, 42.1274605],
  [21.68885, 42.1271667],
  [21.6886819, 42.1261782],
  [21.6896424, 42.1259377],
  [21.6904052, 42.1256604],
  [21.6927042, 42.1248246],
  [21.6936168, 42.1245307],
  [21.6942051, 42.1254479],
  [21.6960902, 42.1246999],
  [21.694025, 42.1218857],
  [21.6928243, 42.1196146],
  [21.6924641, 42.1188487],
  [21.6920078, 42.1184034],
  [21.6909512, 42.1178334],
  [21.6896544, 42.116533],
  [21.6892342, 42.1158383],
  [21.6919899, 42.1156382],
  [21.6920757, 42.1157018],
  [21.692934, 42.1157018],
  [21.6936207, 42.1159565],
  [21.6942215, 42.1159565],
  [21.6955948, 42.1149378],
  [21.6961098, 42.1146831],
  [21.6976976, 42.1134416],
  [21.6977835, 42.1129322],
  [21.6976118, 42.1126138],
  [21.6973543, 42.1112767],
  [21.6968393, 42.1096212],
  [21.6963243, 42.1086661],
  [21.6968393, 42.1076473],
  [21.6976118, 42.1068194],
  [21.6981268, 42.1064374],
  [21.6988993, 42.1049728],
  [21.6996717, 42.1044633],
  [21.7017317, 42.1007061],
  [21.7021179, 42.1004195],
  [21.7024612, 42.1003559],
  [21.7032337, 42.099719],
  [21.7044353, 42.0996553],
  [21.7047787, 42.099528],
  [21.705122, 42.0992732],
  [21.7057228, 42.0990822],
  [21.7065811, 42.0986364],
  [21.7070103, 42.0982543],
  [21.7072678, 42.0982543],
  [21.7076111, 42.0980632],
  [21.7080402, 42.0979995],
  [21.7088985, 42.0976811],
  [21.7090702, 42.09749],
  [21.7094135, 42.0974263],
  [21.710186, 42.0969805],
  [21.7110443, 42.0967258],
  [21.7122889, 42.0957386],
  [21.7126322, 42.0951654],
  [21.7130594, 42.0948484],
  [21.7131042, 42.0948151],
  [21.71525, 42.0950062],
  [21.7157221, 42.0947196],
  [21.7161512, 42.0937642],
  [21.7170608, 42.0929637],
  [21.7172839, 42.0929497],
  [21.7178396, 42.0929662],
  [21.7186369, 42.092939],
  [21.7195133, 42.0931074],
  [21.7190695, 42.0943374],
  [21.7188978, 42.0954202],
  [21.717782, 42.0979677],
  [21.717782, 42.0993051],
  [21.7182541, 42.0997827],
  [21.7185974, 42.0999101],
  [21.720314, 42.0999101],
  [21.7209148, 42.1000374],
  [21.7212152, 42.1002603],
  [21.7213869, 42.1007061],
  [21.7213869, 42.1010882],
  [21.7213011, 42.1016614],
  [21.7211294, 42.1019798],
  [21.7211294, 42.1034445],
  [21.7215157, 42.103731],
  [21.7227173, 42.103731],
  [21.7231035, 42.1040176],
  [21.7230177, 42.1066284],
  [21.7234468, 42.1080293],
  [21.7236185, 42.1100032],
  [21.722331, 42.1124865],
  [21.7220676, 42.1136263],
  [21.7220395, 42.11407],
  [21.7229193, 42.1141402],
  [21.7239645, 42.1141502],
  [21.7246363, 42.114207],
  [21.7249489, 42.1143011],
  [21.725357, 42.1144458],
  [21.7251676, 42.1145543],
  [21.7248584, 42.1149997],
  [21.7245523, 42.1152357],
  [21.7249485, 42.115592],
  [21.725753, 42.116113],
  [21.7267856, 42.1165272],
  [21.727428, 42.1166964],
  [21.727572, 42.1163446],
  [21.7282204, 42.1155608],
  [21.7286587, 42.1148839],
  [21.7290909, 42.1144163],
  [21.7292891, 42.1142559],
  [21.7305138, 42.1128843],
  [21.7310481, 42.1119089],
  [21.7312342, 42.1114725],
  [21.7315164, 42.1110583],
  [21.7316665, 42.1109781],
  [21.7318886, 42.1107331],
  [21.7321107, 42.1104303],
  [21.7321828, 42.1102922],
  [21.732525, 42.1102343],
  [21.7324709, 42.1105238],
  [21.7333595, 42.1108668],
  [21.7351905, 42.1116862],
  [21.7355748, 42.1118466],
  [21.735959, 42.1119356],
  [21.7362051, 42.1119624],
  [21.7364093, 42.1119668],
  [21.7369652, 42.1121363],
  [21.7379093, 42.112391],
  [21.7386818, 42.112391],
  [21.7397118, 42.1120089],
  [21.7423725, 42.1116906],
  [21.7429304, 42.1120408],
  [21.7436171, 42.1128685],
  [21.7437029, 42.1132505],
  [21.744175, 42.1136007],
  [21.7447758, 42.1137917],
  [21.7455482, 42.1137917],
  [21.7462349, 42.1136644],
  [21.747694, 42.1130277],
  [21.7479944, 42.1128048],
  [21.7491221, 42.1114955],
  [21.7491069, 42.1114656],
  [21.749144, 42.111458],
  [21.7498503, 42.1104137],
  [21.7500011, 42.1104627],
  [21.7507551, 42.1112947],
  [21.7511227, 42.1116164],
  [21.7511227, 42.1118052],
  [21.7514408, 42.1119664],
  [21.7518152, 42.1119785],
  [21.7522777, 42.1118554],
  [21.7524587, 42.1116898],
  [21.7523992, 42.1114359],
  [21.7524847, 42.1113495],
  [21.7545605, 42.1117543],
  [21.7557621, 42.1116906],
  [21.7562342, 42.1121045],
  [21.75632, 42.1125502],
  [21.7570496, 42.112773],
  [21.7576933, 42.1132505],
  [21.757865, 42.1135689],
  [21.7577791, 42.1142056],
  [21.7581654, 42.1144921],
  [21.7587662, 42.1146831],
  [21.7595387, 42.1147468],
  [21.7621136, 42.1157018],
  [21.7638302, 42.1160838],
  [21.7650318, 42.1166569],
  [21.7652893, 42.1166569],
  [21.7655897, 42.116434],
  [21.7656755, 42.1159883],
  [21.765976, 42.1157655],
  [21.7679508, 42.1158249],
  [21.7678635, 42.1163001],
  [21.7685514, 42.116502],
  [21.768508, 42.117389],
  [21.7680788, 42.1182167],
  [21.7681646, 42.119681],
  [21.767993, 42.1201266],
  [21.767478, 42.1208269],
  [21.7671347, 42.1217182],
  [21.7667913, 42.1221639],
  [21.7667055, 42.1224185],
  [21.7667913, 42.1229915],
  [21.766448, 42.1233734],
  [21.7652464, 42.124201],
  [21.7652464, 42.1244556],
  [21.7655897, 42.1250922],
  [21.7655897, 42.1254105],
  [21.7653751, 42.1255697],
  [21.7646027, 42.1254424],
  [21.7640018, 42.125697],
  [21.7619419, 42.125506],
  [21.7615128, 42.125506],
  [21.7612123, 42.1256652],
  [21.7610407, 42.1263018],
  [21.7605686, 42.1267155],
  [21.7594528, 42.1267155],
  [21.7591524, 42.1268747],
  [21.7588949, 42.1273203],
  [21.7588091, 42.1277659],
  [21.7584229, 42.128116],
  [21.7575645, 42.1280523],
  [21.7571783, 42.1284024],
  [21.7564058, 42.1314578],
  [21.75632, 42.1325399],
  [21.7567492, 42.1329218],
  [21.7570925, 42.133431],
  [21.7575216, 42.1342585],
  [21.7575216, 42.1345767],
  [21.7573929, 42.1347359],
  [21.7570496, 42.1348632],
  [21.7561054, 42.1350541],
  [21.755805, 42.1353405],
  [21.755805, 42.1357861],
  [21.7555475, 42.1362953],
  [21.7555475, 42.1371227],
  [21.7554617, 42.1371863],
  [21.7555475, 42.1399867],
  [21.7553759, 42.1408141],
  [21.75529, 42.1435507],
  [21.7546892, 42.1455235],
  [21.7536592, 42.1476872],
  [21.7534018, 42.1488326],
  [21.7531443, 42.1494053],
  [21.7534447, 42.1497553],
  [21.7565346, 42.1509007],
  [21.7584229, 42.1512189],
  [21.7596245, 42.1515371],
  [21.760397, 42.1519189],
  [21.7619419, 42.1524279],
  [21.7660618, 42.1531915],
  [21.7692285, 42.1543522],
  [21.7692808, 42.1543306],
  [21.7692422, 42.1544058],
  [21.7700028, 42.1546665],
  [21.7710774, 42.155156],
  [21.7721311, 42.1557391],
  [21.7727554, 42.1559972],
  [21.7739441, 42.1562286],
  [21.7721791, 42.1613198],
  [21.7710985, 42.1656808],
  [21.7710744, 42.1666954],
  [21.7710504, 42.1672472],
  [21.7712185, 42.1674074],
  [21.7710264, 42.1679057],
  [21.7711945, 42.1689025],
  [21.7713386, 42.1690982],
  [21.7718909, 42.1709315],
  [21.7715437, 42.1723841],
  [21.7686443, 42.1722198],
  [21.7674584, 42.1720405],
  [21.7652893, 42.1714509],
  [21.7646027, 42.1707512],
  [21.762886, 42.1706876],
  [21.7620277, 42.1705603],
  [21.7587662, 42.1696061],
  [21.7555046, 42.16897],
  [21.754303, 42.16897],
  [21.7536163, 42.1690972],
  [21.7526722, 42.1688428],
  [21.7518139, 42.1687791],
  [21.7464924, 42.1688428],
  [21.7458057, 42.1683974],
  [21.7451191, 42.168143],
  [21.7422009, 42.168143],
  [21.742115, 42.1680794],
  [21.7401409, 42.1680157],
  [21.7379951, 42.1692244],
  [21.7356777, 42.1699878],
  [21.7351627, 42.1702423],
  [21.7336178, 42.1701787],
  [21.7329311, 42.1702423],
  [21.731987, 42.1704967],
  [21.7308712, 42.1711329],
  [21.7292404, 42.1711965],
  [21.7261505, 42.1715145],
  [21.7255497, 42.171769],
  [21.7244339, 42.1726595],
  [21.7232323, 42.1730412],
  [21.722374, 42.1730412],
  [21.720314, 42.174059],
  [21.719799, 42.174059],
  [21.71422, 42.1725323],
  [21.7130616, 42.1721343],
  [21.7129153, 42.1721837],
  [21.7127213, 42.1717006],
  [21.7119026, 42.1712601],
  [21.7111301, 42.1710056],
  [21.7102718, 42.1711965],
  [21.7083836, 42.1712601],
  [21.7082119, 42.1711965],
  [21.7079115, 42.1709102],
  [21.7080832, 42.1694471],
  [21.7076969, 42.1691608],
  [21.7064953, 42.1694153],
  [21.7058086, 42.1699878],
  [21.705122, 42.1699242],
  [21.703577, 42.1692881],
  [21.7027187, 42.1694789],
  [21.7022038, 42.1694789],
  [21.7019033, 42.1691926],
  [21.702075, 42.1690018],
  [21.702075, 42.1688109],
  [21.7017746, 42.1685883],
  [21.7004871, 42.1682702],
  [21.7001867, 42.1679839],
  [21.7002726, 42.1677295],
  [21.7009592, 42.1669661],
  [21.7012167, 42.1661391],
  [21.701806, 42.1655227],
  [21.7020046, 42.1649663],
  [21.7019033, 42.1643577],
  [21.7027617, 42.16264],
  [21.7028475, 42.1620674],
  [21.70362, 42.1613039],
  [21.7041349, 42.1601587],
  [21.7048216, 42.159268],
  [21.7052937, 42.158918],
  [21.7066669, 42.158409],
  [21.7072248, 42.1579954],
  [21.7073965, 42.1577409],
  [21.7082119, 42.1572001],
  [21.7107868, 42.1563093],
  [21.7110014, 42.1560866],
  [21.7110014, 42.1558321],
  [21.7107439, 42.1554504],
  [21.7097139, 42.1541778],
  [21.7092419, 42.1538278],
  [21.7089415, 42.1537324],
  [21.7088985, 42.1535733],
  [21.7076111, 42.152937],
  [21.7047787, 42.1505826],
  [21.7039204, 42.1502008],
  [21.7029762, 42.1502008],
  [21.7007446, 42.1495008],
  [21.6999722, 42.1496917],
  [21.6976118, 42.1505369],
  [21.6965389, 42.1508371],
  [21.6952997, 42.1512308],
  [21.6946507, 42.1513462],
  [21.6941357, 42.1511553],
  [21.6936207, 42.1507735],
  [21.6916466, 42.1497553],
  [21.6903591, 42.1496917],
  [21.6896725, 42.1495644],
  [21.6884708, 42.1487372],
  [21.6877842, 42.1485463],
  [21.6871834, 42.1480372],
  [21.6867542, 42.1478463],
  [21.6863251, 42.1479099],
  [21.6856813, 42.1483872],
  [21.6855097, 42.1487054],
  [21.6850376, 42.1490554],
  [21.6846943, 42.1491826],
  [21.6842651, 42.1491826],
  [21.6834068, 42.1493735],
  [21.6824627, 42.1494372],
  [21.6816044, 42.149819],
  [21.6806602, 42.1498826],
  [21.6795444, 42.1502008],
  [21.6783428, 42.1502008],
  [21.6779995, 42.150328],
  [21.6773129, 42.1508371],
  [21.6764545, 42.151028],
  [21.6756821, 42.1514734],
  [21.6749096, 42.1514098],
  [21.6741371, 42.151728],
  [21.6736221, 42.151728],
  [21.673193, 42.1516007],
  [21.6724205, 42.1508371],
  [21.6720772, 42.1507735],
  [21.6718626, 42.1509326],
  [21.6716051, 42.151378],
  [21.671133, 42.151728],
  [21.6706147, 42.1519449],
  [21.6698316, 42.1508787],
  [21.6695264, 42.1497105],
  [21.6693735, 42.1482599],
  [21.6694593, 42.1478145],
  [21.6686499, 42.1468494],
];
const kumanovoCoordinates: LatLngExpression[] = kumanovoCoordinatesPolygon.map(
  (coord) => [coord[1], coord[0]] as LatLngExpression,
);
const testCoordinatesPolygon: LatLngExpression[][][] = [
  [
    [
      [41.3577473, 21.2931092],
      [41.3577035, 21.2931233],
      [41.3576537, 21.2931488],
      [41.3576109, 21.2931897],
      [41.3575686, 21.2932849],
      [41.3575203, 21.2933533],
      [41.357472, 21.2934016],
      [41.357427, 21.2934332],
      [41.3573653, 21.2934559],
      [41.3572877, 21.2934592],
      [41.3572128, 21.2934767],
      [41.3571277, 21.2935142],
      [41.3569616, 21.2936617],
      [41.356866, 21.2937402],
      [41.3567306, 21.2938213],
      [41.3565338, 21.2939387],
      [41.3564502, 21.2939782],
      [41.3565362, 21.2943858],
      [41.3566478, 21.2954746],
      [41.3566646, 21.2968623],
      [41.355998, 21.2968761],
      [41.3558823, 21.2988484],
      [41.3558097, 21.2988703],
      [41.355998, 21.3010125],
      [41.3560073, 21.3011189],
      [41.3558857, 21.3012991],
      [41.3558212, 21.3013903],
      [41.3556884, 21.3014654],
      [41.3555877, 21.301562],
      [41.3553831, 21.3017465],
      [41.3552172, 21.3018624],
      [41.3550167, 21.3019557],
      [41.3548468, 21.3020019],
      [41.3546986, 21.3020148],
      [41.3545971, 21.301959],
      [41.3543362, 21.3019557],
      [41.3540213, 21.3019214],
      [41.3539528, 21.3019429],
      [41.3538449, 21.3020094],
      [41.3536677, 21.3019772],
      [41.3534422, 21.3020201],
      [41.3533327, 21.3020233],
      [41.3531314, 21.3020877],
      [41.352918, 21.3022379],
      [41.3524154, 21.3026853],
      [41.3520248, 21.3030447],
      [41.3518267, 21.3032518],
      [41.3516343, 21.3034089],
      [41.3516813, 21.3035101],
      [41.3517131, 21.3035786],
      [41.3518841, 21.3039471],
      [41.3525997, 21.3046281],
      [41.3528437, 21.3047275],
      [41.3530782, 21.304578],
      [41.3532269, 21.3047354],
      [41.3532172, 21.3050189],
      [41.3525413, 21.3052316],
      [41.3523949, 21.3057404],
      [41.3525559, 21.3059786],
      [41.3525634, 21.3064261],
      [41.3531254, 21.3069552],
      [41.3532336, 21.3072453],
      [41.3536804, 21.3075612],
      [41.3542235, 21.3080603],
      [41.3544607, 21.3085282],
      [41.3546979, 21.3093829],
      [41.3548759, 21.3098264],
      [41.3551591, 21.3102813],
      [41.3553733, 21.3107534],
      [41.3556136, 21.3111504],
      [41.355536, 21.3123374],
      [41.3553579, 21.3140348],
      [41.3561151, 21.3142918],
      [41.3560664, 21.3144646],
      [41.3559621, 21.3145439],
      [41.3559818, 21.3146416],
      [41.3559137, 21.3146995],
      [41.3559657, 21.3147864],
      [41.3559057, 21.3148336],
      [41.3558972, 21.3151297],
      [41.3558248, 21.3152263],
      [41.3558211, 21.3153164],
      [41.3558731, 21.3153175],
      [41.3558654, 21.3154988],
      [41.3559399, 21.3154586],
      [41.3560442, 21.3155079],
      [41.356109, 21.3156088],
      [41.3561851, 21.3156072],
      [41.3561952, 21.315693],
      [41.3562761, 21.3157214],
      [41.3563563, 21.3158352],
      [41.3563547, 21.3159575],
      [41.3562637, 21.315988],
      [41.3562661, 21.3160996],
      [41.3562335, 21.3161007],
      [41.356248, 21.3161667],
      [41.3563043, 21.3161694],
      [41.3563426, 21.3162337],
      [41.3564936, 21.3162445],
      [41.3565419, 21.3162364],
      [41.35662, 21.3163126],
      [41.3567191, 21.3163223],
      [41.3569546, 21.3166441],
      [41.3569385, 21.3169284],
      [41.3568717, 21.31701],
      [41.3568982, 21.3171913],
      [41.3569804, 21.3171816],
      [41.3569868, 21.3172396],
      [41.3569627, 21.3173174],
      [41.3569264, 21.3173522],
      [41.3569325, 21.3174595],
      [41.3569969, 21.3174702],
      [41.3569204, 21.3176929],
      [41.3570573, 21.3182293],
      [41.3570891, 21.3188151],
      [41.3572264, 21.3194095],
      [41.3575042, 21.3199566],
      [41.3577297, 21.3200693],
      [41.3579065, 21.320344],
      [41.3580152, 21.3207838],
      [41.3581686, 21.3210617],
      [41.3583538, 21.3210403],
      [41.3584098, 21.3210896],
      [41.358527, 21.3211315],
      [41.358986, 21.3218825],
      [41.3590943, 21.321846],
      [41.3592477, 21.322038],
      [41.3593802, 21.3221088],
      [41.359437, 21.3222204],
      [41.3595175, 21.3222365],
      [41.3598195, 21.3230197],
      [41.3599237, 21.3228974],
      [41.3601694, 21.3233424],
      [41.3602785, 21.3235401],
      [41.3603751, 21.323465],
      [41.3604476, 21.3236474],
      [41.3606204, 21.3237473],
      [41.360548, 21.3238814],
      [41.3604529, 21.3240025],
      [41.3603386, 21.3241196],
      [41.3604633, 21.324319],
      [41.3606368, 21.3247363],
      [41.3607697, 21.3251923],
      [41.3609589, 21.32582],
      [41.3611079, 21.3257609],
      [41.3611518, 21.3260892],
      [41.36118, 21.3264969],
      [41.3612218, 21.3272498],
      [41.3612398, 21.327985],
      [41.3611614, 21.3291126],
      [41.3611548, 21.329552],
      [41.3611957, 21.3295683],
      [41.361277, 21.3298111],
      [41.3613213, 21.3298111],
      [41.3613334, 21.3300418],
      [41.3614377, 21.3300428],
      [41.3614381, 21.3306318],
      [41.3613886, 21.3308826],
      [41.3618952, 21.3308414],
      [41.3620735, 21.3307978],
      [41.3621064, 21.3329385],
      [41.3622232, 21.3329493],
      [41.3622594, 21.333711],
      [41.3622836, 21.3340651],
      [41.362348, 21.3360338],
      [41.3624044, 21.3368385],
      [41.3624482, 21.3371078],
      [41.3627345, 21.3385604],
      [41.3628915, 21.3394724],
      [41.3630606, 21.3400732],
      [41.3632132, 21.3404713],
      [41.3631448, 21.3404927],
      [41.363797, 21.3422308],
      [41.3635317, 21.3424336],
      [41.3652951, 21.3457595],
      [41.3652468, 21.3464354],
      [41.3651421, 21.3468646],
      [41.3653112, 21.3474659],
      [41.3656252, 21.3473209],
      [41.3662774, 21.3469562],
      [41.3669135, 21.3467148],
      [41.3668653, 21.3471972],
      [41.3667525, 21.3479911],
      [41.3671954, 21.3491284],
      [41.3674611, 21.3491391],
      [41.367501, 21.3492796],
      [41.366978, 21.3496219],
      [41.3674366, 21.3505456],
      [41.3681781, 21.3499759],
      [41.3682659, 21.3504169],
      [41.3686129, 21.3510274],
      [41.3693876, 21.3519272],
      [41.3699089, 21.3512524],
      [41.3697016, 21.3505432],
      [41.3701183, 21.3497718],
      [41.3704504, 21.3487086],
      [41.3709878, 21.3486131],
      [41.3729302, 21.3483009],
      [41.3751523, 21.3475391],
      [41.3750959, 21.3472709],
      [41.3768248, 21.3469286],
      [41.3770825, 21.3469072],
      [41.3777507, 21.3469179],
      [41.3778815, 21.3475928],
      [41.3797834, 21.3474868],
      [41.3805039, 21.3472883],
      [41.3803106, 21.3453193],
      [41.3803033, 21.3447158],
      [41.3800715, 21.3446611],
      [41.3800721, 21.3443792],
      [41.380021, 21.3438862],
      [41.3798678, 21.3423147],
      [41.3795989, 21.3424027],
      [41.3793098, 21.340677],
      [41.3791123, 21.3394981],
      [41.3790669, 21.3392267],
      [41.3790306, 21.3390102],
      [41.3788422, 21.3391197],
      [41.3782577, 21.3362207],
      [41.3782416, 21.3352981],
      [41.3775976, 21.3352552],
      [41.3774575, 21.3360083],
      [41.3771167, 21.3361545],
      [41.3769148, 21.3364376],
      [41.3767651, 21.3365233],
      [41.3763095, 21.3352981],
      [41.3759874, 21.3352766],
      [41.3759118, 21.334914],
      [41.3758275, 21.3348905],
      [41.3752194, 21.3347209],
      [41.3749848, 21.3336195],
      [41.3747626, 21.3327076],
      [41.3744724, 21.3320401],
      [41.3742597, 21.3313001],
      [41.3741389, 21.3311147],
      [41.3739352, 21.3313405],
      [41.3737786, 21.3315174],
      [41.3735882, 21.331697],
      [41.3734863, 21.331773],
      [41.3733679, 21.3318418],
      [41.3732395, 21.3318923],
      [41.3730971, 21.3319305],
      [41.3729649, 21.3313686],
      [41.3728338, 21.330795],
      [41.3729, 21.3305354],
      [41.3728843, 21.3301325],
      [41.372828, 21.3297066],
      [41.3729493, 21.3292281],
      [41.3729922, 21.3287619],
      [41.3731059, 21.3284816],
      [41.373058, 21.328192],
      [41.3729055, 21.3283223],
      [41.3727927, 21.3279656],
      [41.3728782, 21.3277683],
      [41.3730371, 21.3273323],
      [41.3731909, 21.3272942],
      [41.3734304, 21.3267933],
      [41.3734362, 21.3262382],
      [41.3737514, 21.326363],
      [41.3736812, 21.3256133],
      [41.3736438, 21.3251074],
      [41.3737477, 21.3245067],
      [41.3740971, 21.3236077],
      [41.3742308, 21.3220606],
      [41.3743918, 21.3211593],
      [41.37487, 21.320389],
      [41.3748748, 21.3194427],
      [41.3745158, 21.3172562],
      [41.3749022, 21.3164837],
      [41.3750012, 21.3155525],
      [41.3752951, 21.3150482],
      [41.3756061, 21.3147972],
      [41.3757379, 21.3145815],
      [41.3756544, 21.3142714],
      [41.375762, 21.3140075],
      [41.375919, 21.3134979],
      [41.3760358, 21.3132726],
      [41.3765601, 21.3128821],
      [41.3767, 21.312645],
      [41.3766235, 21.3125591],
      [41.3769375, 21.3125001],
      [41.3770703, 21.3123177],
      [41.3772716, 21.3120602],
      [41.377662, 21.3116794],
      [41.377824, 21.3113264],
      [41.3780364, 21.3109283],
      [41.3781853, 21.3105584],
      [41.3783658, 21.3103195],
      [41.3781289, 21.3100325],
      [41.3778633, 21.3103973],
      [41.3775493, 21.3105796],
      [41.3773396, 21.3107309],
      [41.3771468, 21.3107513],
      [41.3768006, 21.3106869],
      [41.3768006, 21.3104294],
      [41.3766557, 21.3103651],
      [41.3764705, 21.310011],
      [41.3764947, 21.3093244],
      [41.3763095, 21.3090991],
      [41.3760841, 21.3091527],
      [41.3759472, 21.309378],
      [41.3758824, 21.3096902],
      [41.375504, 21.3093254],
      [41.3751904, 21.3091527],
      [41.3750777, 21.3093995],
      [41.3749247, 21.309614],
      [41.3746832, 21.3096248],
      [41.3745142, 21.3094209],
      [41.3735319, 21.3084339],
      [41.373443, 21.3082311],
      [41.3732823, 21.3081978],
      [41.3732984, 21.3074683],
      [41.3729844, 21.3074361],
      [41.3725251, 21.3070187],
      [41.3720988, 21.3065671],
      [41.3717285, 21.3071571],
      [41.3713581, 21.3073824],
      [41.3710682, 21.3073503],
      [41.3710119, 21.3075756],
      [41.3706657, 21.307597],
      [41.3706975, 21.3077698],
      [41.3703356, 21.3079618],
      [41.3702309, 21.3078867],
      [41.3701097, 21.3079522],
      [41.3699652, 21.3082837],
      [41.3696029, 21.308348],
      [41.369466, 21.30823],
      [41.3693287, 21.3081775],
      [41.3691117, 21.3076936],
      [41.3684676, 21.3077365],
      [41.3680727, 21.3078341],
      [41.367759, 21.3082622],
      [41.3673403, 21.3084768],
      [41.3663661, 21.3085304],
      [41.3660516, 21.3089821],
      [41.3656897, 21.3091527],
      [41.365432, 21.3090991],
      [41.3655002, 21.308517],
      [41.365487, 21.3077672],
      [41.3656063, 21.3071795],
      [41.3655923, 21.3068847],
      [41.3653841, 21.3069067],
      [41.3652073, 21.3060266],
      [41.3648849, 21.3054559],
      [41.3647378, 21.3054722],
      [41.3645021, 21.3046592],
      [41.3644694, 21.3039628],
      [41.3646944, 21.3036648],
      [41.364851, 21.3031991],
      [41.3647814, 21.3030744],
      [41.3646166, 21.3033986],
      [41.364513, 21.3029692],
      [41.3644081, 21.3027616],
      [41.364656, 21.3026094],
      [41.3648661, 21.3023611],
      [41.365156, 21.302506],
      [41.3654388, 21.3029729],
      [41.3657224, 21.3030783],
      [41.366089, 21.3028917],
      [41.3661936, 21.3035081],
      [41.3663712, 21.3037831],
      [41.3664091, 21.3041379],
      [41.3664152, 21.3047017],
      [41.3668389, 21.3045149],
      [41.3669069, 21.3043076],
      [41.3668262, 21.3040545],
      [41.3670952, 21.3036464],
      [41.3672256, 21.3036343],
      [41.3672372, 21.3034632],
      [41.3675208, 21.3035605],
      [41.3675787, 21.3033402],
      [41.3669486, 21.3029612],
      [41.3665422, 21.3025864],
      [41.3662611, 21.302392],
      [41.3661164, 21.3020532],
      [41.3660052, 21.3015664],
      [41.3657541, 21.3016632],
      [41.3654769, 21.3009958],
      [41.3648848, 21.2987421],
      [41.3644589, 21.2988744],
      [41.3641473, 21.2990777],
      [41.3639588, 21.2988784],
      [41.3637943, 21.2985203],
      [41.3642236, 21.2982281],
      [41.3648845, 21.2979555],
      [41.36526, 21.297887],
      [41.3652915, 21.2977671],
      [41.3649273, 21.2977668],
      [41.3645777, 21.2978283],
      [41.3638925, 21.2980644],
      [41.3635848, 21.2982573],
      [41.3633996, 21.2978454],
      [41.3633745, 21.297607],
      [41.363361, 21.2974052],
      [41.362981, 21.2952059],
      [41.3628431, 21.2952051],
      [41.3626243, 21.295148],
      [41.3623117, 21.295012],
      [41.3617224, 21.2947349],
      [41.3614607, 21.2947027],
      [41.3611642, 21.2947062],
      [41.3609105, 21.2947706],
      [41.3607011, 21.2948082],
      [41.3604098, 21.2948208],
      [41.3599724, 21.2947706],
      [41.359669, 21.2947135],
      [41.3593362, 21.2945989],
      [41.3591013, 21.2945364],
      [41.3589928, 21.2945045],
      [41.3588683, 21.2944185],
      [41.3588001, 21.294303],
      [41.3587716, 21.2941346],
      [41.3587244, 21.2939821],
      [41.3587178, 21.2938493],
      [41.3586314, 21.2936889],
      [41.3585704, 21.2937344],
      [41.3584492, 21.2936715],
      [41.3583492, 21.2936401],
      [41.3583145, 21.2935796],
      [41.3582322, 21.2934131],
      [41.3581089, 21.2933236],
      [41.3579149, 21.2931696],
      [41.3578419, 21.2931333],
      [41.3577473, 21.2931092],
    ],
  ],
];
// const testCoordinates: LatLngExpression[][][] = testCoordinatesPolygon.map(
//   (polygonData) =>
//     polygonData.map((coordinatesArray) =>
//       coordinatesArray.map((coord) => [coord[1], coord[0]] as LatLngExpression),
//     ),
// );
export default function MapWithControls() {
  //   console.log(structuredMunicipalities);
  const [selectedMunicipality, setSelectedMunicipality] =
    useState<PopulatedPlace | null>(null);
  const [selectedCity, setSelectedCity] = useState<PopulatedPlace | null>(null);
  const [cities, setCities] = useState<PopulatedPlace[]>(() => {
    return [];
  });
  const [municipalities, setMunicipalities] = useState<PopulatedPlace[]>(() => {
    console.log(structuredMunicipalities);
    const municipalitiesArray: PopulatedPlace[] = [];
    Object.keys(structuredMunicipalities).forEach((key) => {
      const place = populatedPlaces2.find((pp) => pp.id === key);
      if (!place) {
        console.log("my key ", key);
      }
      municipalitiesArray.push({
        id: key,
        name: place?.name || "Name",
        centerPoint: [42, 40],
        coordinates: [],
      });
    });
    return municipalitiesArray;
  });

  //effect description
  useEffect(() => {
    console.log(selectedMunicipality);
    if (selectedMunicipality) {
      setCities(() => {
        const citiesArray: PopulatedPlace[] = [];

        structuredMunicipalities[selectedMunicipality.id].forEach(
          (cityId: string) => {
            const city = populatedPlaces2.find((pp) => pp.id === cityId);
            if (city) {
              citiesArray.push({
                id: cityId,
                name: city.name || "Name",
                centerPoint: [42, 40],
                coordinates: [],
              });
            }
          },
        );
        return citiesArray;
      });
    }
  }, [selectedMunicipality]);

  return (
    <div style={{ height: "100vh", width: "100%" }}>
      <div
        style={{
          position: "absolute",
          zIndex: 1000,
          background: "white",
          padding: "10px",
        }}
      >
        <select
          onChange={(e) =>
            setSelectedMunicipality(
              municipalities.find((m) => m.name === e.target.value) || null,
            )
          }
        >
          <option value="">Select Municipality</option>
          {municipalities.map((m) => (
            <option key={m.id} value={m.name}>
              {m.name}
            </option>
          ))}
        </select>
        <select
          onChange={(e) =>
            setSelectedCity(
              cities.find((c) => c.name === e.target.value) || null,
            )
          }
        >
          <option value="">Select City/Village</option>
          {cities.map((c) => (
            <option key={c.id} value={c.name}>
              {c.name}
            </option>
          ))}
        </select>
      </div>
      <MapContainer
        center={northMacedoniaCoordinates}
        zoom={9}
        style={{ height: "100%", width: "100%" }}
      >
        <TileLayer
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        />
        {selectedMunicipality && (
          <Polygon positions={selectedMunicipality.coordinates} color="blue" />
        )}
        <Polygon positions={kumanovoCoordinates} color="red" />
        {/* <Polyline
          pathOptions={{ color: "black" }}
          positions={kumanovoCoordinates}
        /> */}

        {/* {testCoordinates.map((coords) => ( */}
        <Polygon positions={testCoordinatesPolygon} color="blue" />
        {/* ))} */}
        {selectedCity && (
          <Marker position={selectedCity.centerPoint}>
            <Popup>{selectedCity.name}</Popup>
          </Marker>
        )}
      </MapContainer>
    </div>
  );
}
